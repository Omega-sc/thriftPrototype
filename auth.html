<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentication - CampusKart</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="auth-body">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen hidden">
      <div class="loading-container">
        <div class="animated-logo">
          <div class="logo-shape"></div>
          <div class="logo-text">CampusKart</div>
        </div>
        <div class="loading-text">Authenticating...</div>
      </div>
    </div>

    <!-- Background Particles -->
    <div class="auth-particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>

    <!-- Main Authentication Container -->
    <div class="auth-container">
      <div class="auth-card glass-card">
        <!-- Header -->
        <div class="auth-header"> 
          <div class="brand-logo">CK</div>
          <h1 class="auth-title">Welcome to CampusKart</h1>
          <p class="auth-subtitle">Join the college thrift community</p>
        </div>

        <!-- Tab Navigation -->
        <div class="auth-tabs">
          <button class="auth-tab active" data-tab="signup">Sign Up</button>
          <button class="auth-tab" data-tab="signin">Sign In</button>
          <div class="tab-indicator"></div>
        </div>

        <!-- Sign Up Form -->
        <div id="signup-form" class="auth-form-container active">
          <form class="auth-form" id="signupForm">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">First Name</label>
                <input
                  type="text"
                  id="firstName"
                  class="form-control animated-input"
                  placeholder="Enter your first name"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Last Name</label>
                <input
                  type="text"
                  id="lastName"
                  class="form-control animated-input"
                  placeholder="Enter your last name"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Email Address</label>
              <input
                type="email"
                id="signupEmail"
                class="form-control animated-input"
                placeholder="Enter your email"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label">Password</label>
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="signupPassword"
                  class="form-control animated-input"
                  placeholder="Create a strong password"
                  required
                />
                <button type="button" class="password-toggle" id="toggleSignupPassword">
                  üëÅÔ∏è
                </button>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Phone Number</label>
              <input
                type="tel"
                id="phoneNumber"
                class="form-control animated-input"
                placeholder="Enter your phone number"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label">Hostel Name</label>
              <select id="hostelName" class="form-control animated-input" required>
                <option value="">Select your hostel</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="H">H</option>
                <option value="J">J</option>
                <option value="K">K</option>
                <option value="L">L</option>
                <option value="M">M</option>
                <option value="O">O</option>
                <option value="E">E</option>
                <option value="G">G</option>
                <option value="I">I</option>
                <option value="N">N</option>
                <option value="HOTEL-PG">HOTEL-PG</option>
                <option value="Q">Q</option>
                <option value="FRF">FRF</option>
                <option value="FRG">FRG</option>
              </select>
            </div>

            <div class="terms-checkbox">
              <input type="checkbox" id="agreeTerms" required />
              <label for="agreeTerms" class="terms-label">
                I agree to the <a href="#" class="terms-link">Terms of Service</a> 
                and <a href="#" class="terms-link">Privacy Policy</a>
              </label>
            </div>

            <button type="submit" class="btn btn--primary btn--full-width animated-btn" id="signupBtn">
              <span class="btn-text">Create Account</span>
              <span class="btn-loader hidden">üîÑ</span>
            </button>

            <div class="auth-divider">
              <span class="divider-text">or continue with</span>
            </div>

            <button type="button" class="btn btn--outline btn--full-width google-btn" id="googleSignupBtn">
              <span class="btn-text">
                <span class="google-icon">üîç</span>
                Sign up with Google
              </span>
              <span class="btn-loader hidden">üîÑ</span>
            </button>
          </form>
        </div>

        <!-- Sign In Form -->
        <div id="signin-form" class="auth-form-container">
          <form class="auth-form" id="signinForm">
            <div class="form-group">
              <label class="form-label">Email Address</label>
              <input
                type="email"
                id="signinEmail"
                class="form-control animated-input"
                placeholder="Enter your email"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label">Password</label>
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="signinPassword"
                  class="form-control animated-input"
                  placeholder="Enter your password"
                  required
                />
                <button type="button" class="password-toggle" id="toggleSigninPassword">
                  üëÅÔ∏è
                </button>
              </div>
            </div>

            <div class="form-options">
              <label class="remember-checkbox">
                <input type="checkbox" id="rememberMe" />
                <span class="checkmark"></span>
                Remember me
              </label>
              <a href="#" class="forgot-password-link" id="forgotPasswordLink">
                Forgot Password?
              </a>
            </div>

            <button type="submit" class="btn btn--primary btn--full-width animated-btn" id="signinBtn">
              <span class="btn-text">Sign In</span>
              <span class="btn-loader hidden">üîÑ</span>
            </button>

            <div class="auth-divider">
              <span class="divider-text">or continue with</span>
            </div>

            <button type="button" class="btn btn--outline btn--full-width google-btn" id="googleSigninBtn">
              <span class="btn-text">
                <span class="google-icon">üîç</span>
                Sign in with Google
              </span>
              <span class="btn-loader hidden">üîÑ</span>
            </button>
          </form>
        </div>
      </div>

      <!-- Footer -->
      <div class="auth-footer">
        <p class="footer-text">
          Secure authentication powered by Firebase üîí
        </p>
      </div>
    </div>

    <!-- Error/Success Messages -->
    <div class="message-container" id="messageContainer"></div>

    <!-- Password Reset Modal -->
    <div class="modal hidden" id="resetPasswordModal">
      <div class="modal-overlay"></div>
      <div class="modal-content glass-card">
        <div class="modal-header">
          <div class="reset-icon">üîë</div>
          <h3 class="modal-title">Reset Password</h3>
          <p class="modal-message">
            Enter your email address and we'll send you a reset link
          </p>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <input
              type="email"
              id="resetEmail"
              class="form-control animated-input"
              placeholder="Enter your email"
              required
            />
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn--outline" id="cancelReset">Cancel</button>
          <button class="btn btn--primary" id="sendResetEmail">
            <span class="btn-text">Send Reset Link</span>
            <span class="btn-loader hidden">üîÑ</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      // Import Firebase modules using the same version as index.html
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
      import { 
        getAuth, 
        createUserWithEmailAndPassword, 
        signInWithEmailAndPassword,
        signInWithPopup,
        GoogleAuthProvider,
        sendPasswordResetEmail,
        updateProfile,
        onAuthStateChanged
      } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
      import { 
        getFirestore, 
        doc, 
        setDoc, 
        getDoc,
        collection,
        addDoc
      } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

      // Firebase configuration from your existing setup
      const firebaseConfig = {
        apiKey: "AIzaSyBrVVik7_oVaPXpyI20jcyq9nqXUKcwcOM",
        authDomain: "thrift-6bd6d.firebaseapp.com",
        projectId: "thrift-6bd6d",
        storageBucket: "thrift-6bd6d.firebasestorage.app",
        messagingSenderId: "595724600327",
        appId: "1:595724600327:web:e1a9d65d6e6ee68e0456a2",
        measurementId: "G-7PGCTDYP38",
      };

      // Initialize Firebase with error handling
      try {
        console.log('üî• Initializing Firebase...');
        const app = initializeApp(firebaseConfig);
        console.log('‚úÖ Firebase app initialized:', app);
        
        const auth = getAuth(app);
        console.log('‚úÖ Auth initialized:', auth);
        
        const db = getFirestore(app);
        console.log('‚úÖ Firestore initialized:', db);
        
        // Configure Google Provider with proper scopes
        const googleProvider = new GoogleAuthProvider();
        googleProvider.addScope('email');
        googleProvider.addScope('profile');
        googleProvider.setCustomParameters({
          prompt: 'select_account'
        });
        console.log('‚úÖ Google provider configured:', googleProvider);

        // Make Firebase services available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.googleProvider = googleProvider;
        window.firebaseModules = {
          createUserWithEmailAndPassword,
          signInWithEmailAndPassword,
          signInWithPopup,
          sendPasswordResetEmail,
          updateProfile,
          onAuthStateChanged,
          doc,
          setDoc,
          getDoc,
          collection,
          addDoc
        };
        
        console.log('‚úÖ Firebase setup complete!');
        
        // Signal that Firebase is ready
        window.firebaseReady = true;
        window.dispatchEvent(new CustomEvent('firebaseReady'));
        
      } catch (error) {
        console.error('‚ùå Firebase initialization failed:', error);
        window.firebaseError = error;
      }
    </script>

    <!-- Authentication Logic -->
    <script src="auth.js"></script>
  </body>
</html>